# Lightsail Development Roadmap: Security-First Phases

> **Last Updated:** January 3, 2026
>
> **Guiding Principle:** Security creates compliance — compliance does not create security.

This document defines the phased development roadmap for Lightsail. Each phase builds on the previous one, progressively transforming the platform from a compliance management tool into a security telemetry and governance platform.

---

## Table of Contents

1. [Philosophy Recap](#philosophy-recap)
2. [Phase 0: Foundation Fixes](#phase-0-foundation-fixes)
3. [Phase 1: Integration Infrastructure](#phase-1-integration-infrastructure)
4. [Phase 2: Control Verification Layer](#phase-2-control-verification-layer)
5. [Phase 3: Risk-First Dashboard](#phase-3-risk-first-dashboard)
6. [Phase 4: Calculated Risk Metrics](#phase-4-calculated-risk-metrics)
7. [Phase 5: Policy Lifecycle Operationalisation](#phase-5-policy-lifecycle-operationalisation)
8. [Phase 6: Advanced Integrations](#phase-6-advanced-integrations)
9. [Phase 7: Continuous Compliance Assessment](#phase-7-continuous-compliance-assessment)
10. [Phase 8: Executive Reporting & Audit Packages](#phase-8-executive-reporting--audit-packages)
11. [Success Metrics](#success-metrics)
12. [Anti-Patterns to Avoid](#anti-patterns-to-avoid)

---

## Philosophy Recap

Before building any feature, ask these questions:

| Question | If "No", Stop |
|----------|---------------|
| Can this be verified from an external integration? | Don't build manual-only features |
| Does this measure effectiveness, not just existence? | Don't build checkbox features |
| Does this reduce risk, not just track compliance? | Don't build audit-only features |
| Is this generated by system behaviour? | Don't build evidence upload features |

### The Core Insight

> Traditional compliance tools ask: "Do you have this control?"
>
> Lightsail asks: "Is this control working? How do we know?"

### What We're Building

A **security operating system** that:
- Observes actual system state through integrations
- Enforces security behaviours through workflows
- Generates evidence automatically as a by-product
- Measures whether controls actually work
- Reduces risk as the primary objective

### What We're NOT Building

- A checklist tool for auditors
- A document repository for evidence
- A Vanta/Drata clone with different branding
- A compliance percentage calculator

---

## Phase 0: Foundation Fixes

**Goal:** Prepare the existing codebase for the security-first pivot without breaking what works.

**Duration:** 1-2 weeks

### 0.1 Schema Enhancements

Add verification tracking to the Control model:

```prisma
model Control {
  // ... existing fields ...

  // NEW: Verification tracking
  verificationStatus    String    @default("unverified") @db.VarChar(50)
  // Values: "unverified", "verified", "failed", "stale"
  verifiedAt            DateTime?
  verificationSource    String?   @db.VarChar(100)
  // e.g., "aws-iam", "google-workspace", "manual"
  verificationDetails   Json      @default("{}")
}
```

Add provisional flag to Evidence model:

```prisma
model Evidence {
  // ... existing fields ...

  // NEW: Provisional tracking
  isProvisional         Boolean   @default(true)
  // true = manual upload, false = integration-generated
}
```

Add effectiveness logging:

```prisma
model ControlEffectivenessLog {
  id                String    @id @default(uuid())
  controlId         String
  effectivenessScore Decimal  @db.Decimal(5, 2)
  factors           Json      // Breakdown of score components
  calculatedAt      DateTime  @default(now())

  control           Control   @relation(fields: [controlId], references: [id])

  @@index([controlId, calculatedAt])
}
```

### 0.2 API Adjustments

**Control Status Changes:**
- Require `justification` field when changing `implementationStatus`
- Log all status changes to audit log with justification

**Evidence Creation:**
- Default `isProvisional: true` unless `integrationId` is provided
- Add validation: if `source !== "manual"`, require `integrationId`

**Risk Residual Score:**
- Remove manual `residualScore` input from API
- Calculate automatically based on linked control effectiveness
- Trigger recalculation when controls are linked/unlinked

### 0.3 UI Labeling

Update frontend to show honest status:

| Current Label | New Label |
|--------------|-----------|
| "Implemented" | "Implemented (Self-Attested)" or "Implemented (Verified)" |
| Evidence with no integration | "Provisional Evidence" badge |
| "Compliance Progress" | "Framework Coverage" |
| Risk residual score input | Remove (show calculated value only) |

### 0.4 Deliverables Checklist

- [x] Migration: Add `verificationStatus`, `verifiedAt`, `verificationSource` to Control
- [x] Migration: Add `isProvisional` to Evidence
- [x] Migration: Create `ControlEffectivenessLog` table
- [x] API: Control status change requires justification
- [x] API: Evidence creation defaults `isProvisional: true`
- [ ] API: Risk residual score auto-calculated
- [x] UI: Verification status badges on controls
- [x] UI: Provisional badge on manual evidence
- [ ] UI: Rename "Compliance Progress" to "Framework Coverage"

---

## Phase 1: Integration Infrastructure

**Goal:** Build the engine that connects Lightsail to external reality.

**Duration:** 3-4 weeks

### 1.1 Integration Engine Architecture

```
packages/backend/src/integrations/
├── engine/
│   ├── sync-scheduler.ts       # Cron-based sync scheduling
│   ├── sync-runner.ts          # Executes sync jobs
│   ├── sync-queue.ts           # Job queue (Bull/BullMQ)
│   ├── credential-vault.ts     # Encrypted credential storage
│   └── types.ts                # Shared types
├── providers/
│   ├── base-provider.ts        # Abstract integration interface
│   ├── aws/
│   │   ├── index.ts
│   │   ├── iam-collector.ts
│   │   ├── cloudtrail-collector.ts
│   │   └── s3-collector.ts
│   ├── github/
│   │   ├── index.ts
│   │   ├── repo-collector.ts
│   │   └── security-collector.ts
│   └── google-workspace/
│       ├── index.ts
│       ├── directory-collector.ts
│       └── security-collector.ts
├── evidence-generator.ts       # Creates evidence from sync results
├── control-matcher.ts          # Links evidence to controls
└── index.ts                    # Exports
```

### 1.2 Base Provider Interface

```typescript
interface IntegrationProvider {
  readonly type: string;
  readonly name: string;
  readonly requiredScopes: string[];

  // Connection management
  connect(credentials: EncryptedCredentials): Promise<ConnectionResult>;
  disconnect(): Promise<void>;
  testConnection(): Promise<TestResult>;

  // Data collection
  collectAll(): Promise<CollectionResult>;
  collectByCategory(category: string): Promise<CollectionResult>;

  // Evidence generation
  generateEvidence(rawData: unknown): Evidence[];

  // Control mapping
  getSupportedControls(): ControlMapping[];
}

interface CollectionResult {
  success: boolean;
  itemsCollected: number;
  errors: CollectionError[];
  rawData: unknown;
  collectedAt: Date;
}

interface ControlMapping {
  controlPattern: RegExp | string;  // Matches control names/codes
  evidenceType: string;
  verificationLogic: (data: unknown) => VerificationResult;
}
```

### 1.3 Sync Scheduler

```typescript
// Configurable sync frequencies
interface SyncSchedule {
  integrationId: string;
  frequency: 'hourly' | 'daily' | 'weekly' | 'manual';
  lastRunAt: Date | null;
  nextRunAt: Date;
  status: 'pending' | 'running' | 'completed' | 'failed';
}

// Scheduler responsibilities:
// 1. Check for due syncs every minute
// 2. Queue sync jobs (avoid duplicate runs)
// 3. Handle retry logic for failures
// 4. Update Integration.lastSyncAt on completion
```

### 1.4 AWS Integration (First Provider)

**Priority:** HIGH - Most common for startups pursuing SOC 2/ISO 27001

| Collector | Data Collected | Evidence Generated | Controls Addressed |
|-----------|---------------|-------------------|-------------------|
| IAM | Users, MFA status, password policy, access keys | MFA enforcement, password policy compliance | Access control, authentication |
| CloudTrail | Trail configuration, recent events | Audit logging status | Monitoring, audit trails |
| S3 | Bucket policies, encryption, public access | Data protection configuration | Data security, encryption |
| Config | Compliance rules, resource inventory | Configuration compliance | Configuration management |

**Sample Evidence Output:**

```typescript
// Auto-generated from AWS IAM sync
{
  title: "AWS IAM MFA Enforcement Status",
  description: "Automated collection of MFA status for all IAM users",
  type: "config",
  source: "aws-iam",
  integrationId: "int_xxx",
  isProvisional: false,
  validFrom: new Date(),
  validUntil: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24hr validity
  metadata: {
    totalUsers: 47,
    usersWithMFA: 45,
    usersWithoutMFA: 2,
    mfaEnforcementRate: 0.957,
    nonCompliantUsers: [
      { username: "john.doe", email: "john@company.com" },
      { username: "temp-contractor", email: "contractor@external.com" }
    ],
    passwordPolicy: {
      minimumLength: 14,
      requireSymbols: true,
      requireNumbers: true,
      requireUppercase: true,
      requireLowercase: true,
      maxAgeDays: 90
    }
  }
}
```

### 1.5 Google Workspace Integration (Second Provider)

**Priority:** HIGH - Common for startups, covers identity/access controls

| Collector | Data Collected | Evidence Generated | Controls Addressed |
|-----------|---------------|-------------------|-------------------|
| Directory | Users, groups, org units | User inventory, access groups | Access control, user management |
| Security | MFA enrollment, login activity | Authentication compliance | Authentication, monitoring |
| Admin | Admin roles, delegated admins | Privileged access | Privileged access management |
| Drive | Sharing settings, external access | Data sharing policies | Data protection |

### 1.6 GitHub Integration (Third Provider)

**Priority:** MEDIUM - Important for development security controls

| Collector | Data Collected | Evidence Generated | Controls Addressed |
|-----------|---------------|-------------------|-------------------|
| Repos | Repository list, visibility | Asset inventory | Asset management |
| Branch Protection | Protection rules | Change control | Change management |
| Dependabot | Vulnerability alerts | Vulnerability status | Vulnerability management |
| Code Scanning | SAST results | Code security | Secure development |

### 1.7 Deliverables Checklist

- [ ] Integration engine: Sync scheduler with cron
- [ ] Integration engine: Job queue (Bull/BullMQ)
- [x] Integration engine: Credential vault (encrypted storage)
- [x] Integration engine: Evidence generator
- [x] Integration engine: Control matcher
- [ ] Provider: AWS IAM collector
- [ ] Provider: AWS CloudTrail collector
- [ ] Provider: AWS S3 collector
- [ ] Provider: Google Workspace Directory collector
- [ ] Provider: Google Workspace Security collector
- [x] Provider: GitHub repository collector
- [x] Provider: GitHub security collector (branch protection, Dependabot)
- [x] API: Integration connection endpoints
- [x] API: Manual sync trigger endpoint
- [x] API: Integration status/logs endpoints
- [x] UI: Integration connection wizard
- [x] UI: Integration status dashboard
- [x] UI: Sync history/logs view

---

## Phase 2: Control Verification Layer

**Goal:** Controls can now be verified by integration data, not just claimed.

**Duration:** 2-3 weeks

### 2.1 Verification Rules Engine

```typescript
interface VerificationRule {
  id: string;
  name: string;
  description: string;

  // Which controls this rule applies to
  controlMatcher: {
    namePattern?: RegExp;
    codePattern?: RegExp;
    tags?: string[];
  };

  // What evidence is required
  requiredEvidence: {
    source: string;           // Integration source, e.g., "aws-iam"
    type: string;             // Evidence type, e.g., "config"
    freshnessHours: number;   // Max age of evidence
    condition: (metadata: any) => boolean;  // Must return true to verify
  }[];

  // How to combine multiple evidence requirements
  logic: 'all' | 'any';  // All must pass, or any one passes
}

// Example rule: MFA Enforcement
const mfaVerificationRule: VerificationRule = {
  id: "verify-mfa-enforcement",
  name: "MFA Enforcement Verification",
  description: "Verifies MFA is enforced for all users",
  controlMatcher: {
    namePattern: /mfa|multi.?factor|authentication/i,
    tags: ["authentication", "access-control"]
  },
  requiredEvidence: [
    {
      source: "aws-iam",
      type: "config",
      freshnessHours: 24,
      condition: (meta) => meta.mfaEnforcementRate >= 0.95
    },
    {
      source: "google-workspace",
      type: "config",
      freshnessHours: 24,
      condition: (meta) => meta.mfaEnforcementRate >= 0.95
    }
  ],
  logic: 'any'  // Either AWS or Google verification passes
};
```

### 2.2 Verification Status Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    CONTROL CREATED                          │
│                 verificationStatus: "unverified"            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              INTEGRATION SYNCS, EVIDENCE GENERATED          │
│                    Evidence linked to control               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              VERIFICATION ENGINE EVALUATES RULES            │
│                    Checks evidence against rules            │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              ▼               ▼               ▼
        ┌──────────┐   ┌──────────┐   ┌──────────┐
        │ VERIFIED │   │  FAILED  │   │  STALE   │
        │          │   │          │   │          │
        │ All      │   │ Condition│   │ Evidence │
        │ conditions│   │ not met  │   │ expired  │
        │ met      │   │          │   │          │
        └──────────┘   └──────────┘   └──────────┘
```

### 2.3 Control Health Score

Replace simple `implementationStatus` with computed health:

```typescript
interface ControlHealth {
  controlId: string;

  // Overall score (0-100)
  overallScore: number;

  // Score breakdown
  factors: {
    // Is it verified by integration? (0-40 points)
    verificationScore: number;
    verificationStatus: 'verified' | 'failed' | 'stale' | 'unverified';

    // Is evidence fresh? (0-25 points)
    freshnessScore: number;
    daysSinceLastEvidence: number;

    // Is evidence coverage complete? (0-20 points)
    coverageScore: number;
    evidenceTypesPresent: string[];
    evidenceTypesRequired: string[];

    // Has it been reviewed recently? (0-15 points)
    reviewScore: number;
    daysSinceLastReview: number;
  };

  // Recommendations
  recommendations: string[];

  calculatedAt: Date;
}

function calculateControlHealth(control: Control): ControlHealth {
  const factors = {
    verificationScore: getVerificationScore(control),
    freshnessScore: getFreshnessScore(control),
    coverageScore: getCoverageScore(control),
    reviewScore: getReviewScore(control),
  };

  const overallScore =
    factors.verificationScore +
    factors.freshnessScore +
    factors.coverageScore +
    factors.reviewScore;

  return {
    controlId: control.id,
    overallScore,
    factors,
    recommendations: generateRecommendations(factors),
    calculatedAt: new Date(),
  };
}
```

### 2.4 Verification Triggers

| Event | Action |
|-------|--------|
| Integration sync completes | Re-verify all controls linked to that integration |
| Evidence expires (validUntil passed) | Mark linked controls as "stale" |
| Evidence manually approved | Re-verify linked controls |
| Control linked to new evidence | Re-verify that control |
| Verification rule updated | Re-verify all affected controls |

### 2.5 Deliverables Checklist

- [x] Verification rules engine (basic - via integration sync)
- [x] Default verification rules for common controls (pattern matching)
- [x] Verification status calculation job (sync-runner updates controls)
- [ ] Control health score calculator
- [x] Triggers for re-verification (integration sync)
- [ ] API: Get control health score
- [ ] API: Get verification history
- [ ] API: Manual verification trigger
- [x] UI: Control health indicator (completion percentage)
- [x] UI: Verification status badge
- [x] UI: "Why is this unverified?" explanation (automation status section)

---

## Phase 3: Risk-First Dashboard

**Goal:** Reorient the entire UI around risk, with compliance as secondary.

**Duration:** 2-3 weeks

### 3.1 New Dashboard Layout

```
┌─────────────────────────────────────────────────────────────────────┐
│  HEADER: Welcome back, [Name] | [Org] | Last sync: 5 min ago       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  RISK POSTURE (Primary Section)                              │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐            │   │
│  │  │ High/   │ │ Unmiti- │ │ Risk    │ │ Accep-  │            │   │
│  │  │ Critical│ │ gated   │ │ Trend   │ │ ted     │            │   │
│  │  │   3     │ │   5     │ │  ↓ 12%  │ │   2     │            │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘            │   │
│  │                                                              │   │
│  │  Top Risks Requiring Attention:                              │   │
│  │  1. [Critical] Unencrypted data at rest - AWS S3             │   │
│  │  2. [High] MFA not enforced for 2 users                      │   │
│  │  3. [High] Stale access review - 45 days overdue             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  SECURITY HEALTH (Secondary Section)                         │   │
│  │  ┌───────────────────┐ ┌───────────────────┐                 │   │
│  │  │ Controls          │ │ Evidence          │                 │   │
│  │  │ Verified: 45      │ │ Fresh: 120        │                 │   │
│  │  │ Unverified: 12    │ │ Expiring: 8       │                 │   │
│  │  │ Failed: 3         │ │ Expired: 2        │                 │   │
│  │  └───────────────────┘ └───────────────────┘                 │   │
│  │  ┌───────────────────┐ ┌───────────────────┐                 │   │
│  │  │ Integrations      │ │ Policies          │                 │   │
│  │  │ Connected: 4      │ │ Current: 12       │                 │   │
│  │  │ Errors: 0         │ │ Review Due: 2     │                 │   │
│  │  │ Last Sync: 5m ago │ │ Unacknowledged: 5 │                 │   │
│  │  └───────────────────┘ └───────────────────┘                 │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  FRAMEWORK COVERAGE (Tertiary Section)                       │   │
│  │  ⚠️ Based on verified controls only                          │   │
│  │                                                              │   │
│  │  ISO 27001: 67% (45/67 verified) ████████░░░░                │   │
│  │  SOC 2:     72% (38/53 verified) █████████░░░                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Risk Posture Metrics

| Metric | Calculation | Display |
|--------|-------------|---------|
| High/Critical Risks | Count where inherentScore >= 15 | Number with color |
| Unmitigated Risks | Count where linkedControls.length === 0 | Number with warning |
| Risk Trend | Compare current total risk score to 30 days ago | Arrow + percentage |
| Accepted Risks | Count where status === 'accepted' | Number |

### 3.3 Security Health Metrics

| Metric | Calculation | Display |
|--------|-------------|---------|
| Controls Verified | Count where verificationStatus === 'verified' | Green number |
| Controls Unverified | Count where verificationStatus === 'unverified' | Yellow number |
| Controls Failed | Count where verificationStatus === 'failed' | Red number |
| Evidence Fresh | Count where validUntil > now | Green number |
| Evidence Expiring | Count where validUntil within 7 days | Yellow number |
| Evidence Expired | Count where validUntil < now | Red number |

### 3.4 Framework Coverage (Honest Calculation)

```typescript
function calculateFrameworkCoverage(frameworkId: string): FrameworkCoverage {
  const requirements = getFrameworkRequirements(frameworkId);
  const controls = getLinkedControls(requirements);

  // Only count VERIFIED controls
  const verifiedControls = controls.filter(c =>
    c.verificationStatus === 'verified'
  );

  // Coverage based on requirements with verified controls
  const coveredRequirements = requirements.filter(req =>
    verifiedControls.some(c => c.frameworkMappings.includes(req.id))
  );

  return {
    frameworkId,
    totalRequirements: requirements.length,
    coveredRequirements: coveredRequirements.length,
    coveragePercent: (coveredRequirements.length / requirements.length) * 100,
    // Transparency
    totalControls: controls.length,
    verifiedControls: verifiedControls.length,
    selfAttestedControls: controls.length - verifiedControls.length,
  };
}
```

### 3.5 Deliverables Checklist

- [ ] Risk posture section with top risks
- [ ] Security health section with verification stats
- [ ] Framework coverage with verified-only calculation
- [ ] Risk trend calculation (30-day comparison)
- [ ] "Why this number?" tooltips explaining calculations
- [ ] Quick actions based on risks/health
- [ ] Remove or demote old compliance-centric metrics

---

## Phase 4: Calculated Risk Metrics

**Goal:** Risk scores derived from data, not manual entry.

**Duration:** 2 weeks

### 4.1 Residual Risk Calculation

```typescript
function calculateResidualScore(risk: Risk): number {
  const linkedControls = risk.controlLinks;

  if (linkedControls.length === 0) {
    // No controls mitigating this risk
    return risk.inherentScore;
  }

  // Calculate weighted average control effectiveness
  let totalEffectiveness = 0;
  let totalWeight = 0;

  for (const link of linkedControls) {
    const control = link.control;
    const effectiveness = getControlEffectiveness(control);
    const weight = getControlWeight(link);  // Based on relevance

    totalEffectiveness += effectiveness * weight;
    totalWeight += weight;
  }

  const avgEffectiveness = totalWeight > 0
    ? totalEffectiveness / totalWeight
    : 0;

  // Residual = Inherent × (1 - effectiveness)
  // Example: Inherent 20, Effectiveness 0.7 → Residual 6
  return Math.round(risk.inherentScore * (1 - avgEffectiveness));
}

function getControlEffectiveness(control: Control): number {
  // Based on verification status and health score
  switch (control.verificationStatus) {
    case 'verified':
      return 0.9;  // 90% effective if verified
    case 'stale':
      return 0.5;  // 50% effective if evidence stale
    case 'failed':
      return 0.1;  // 10% effective if verification failed
    case 'unverified':
    default:
      return 0.3;  // 30% effective if self-attested
  }
}
```

### 4.2 Risk Recalculation Triggers

| Event | Action |
|-------|--------|
| Control linked to risk | Recalculate residual score |
| Control unlinked from risk | Recalculate residual score |
| Control verification status changes | Recalculate linked risks |
| Control health score changes significantly | Recalculate linked risks |

### 4.3 Risk Trending

```typescript
interface RiskSnapshot {
  id: string;
  organizationId: string;
  date: Date;

  // Aggregate metrics
  totalInherentRisk: number;
  totalResidualRisk: number;
  riskCount: number;
  highCriticalCount: number;

  // Risk distribution
  byCategory: Record<string, { count: number; totalScore: number }>;
  byStatus: Record<string, number>;

  // Control coverage
  risksWithControls: number;
  risksWithoutControls: number;
  avgControlsPerRisk: number;
}

// Daily job captures snapshot
async function captureRiskSnapshot(organizationId: string): Promise<void> {
  const risks = await getRisks(organizationId);

  const snapshot: RiskSnapshot = {
    id: generateId(),
    organizationId,
    date: new Date(),
    totalInherentRisk: sum(risks.map(r => r.inherentScore)),
    totalResidualRisk: sum(risks.map(r => r.residualScore)),
    riskCount: risks.length,
    // ... calculate other metrics
  };

  await saveSnapshot(snapshot);
}
```

### 4.4 Deliverables Checklist

- [ ] Residual score calculation function
- [ ] Control effectiveness scoring
- [ ] Recalculation triggers (database triggers or application events)
- [ ] Risk snapshot daily job
- [ ] API: Get risk trend data
- [ ] UI: Risk trend chart (30/60/90 days)
- [ ] UI: Remove manual residual score input
- [ ] UI: Show "How is this calculated?" explanation

---

## Phase 5: Policy Lifecycle Operationalisation

**Goal:** Policies are enforced workflows with tracked distribution, not just documents.

**Duration:** 2-3 weeks

### 5.1 Policy Distribution Model

```prisma
model PolicyDistribution {
  id              String    @id @default(uuid())
  policyId        String
  userId          String

  // Distribution tracking
  distributedAt   DateTime  @default(now())
  distributedVia  String    @db.VarChar(50)  // "email", "in-app", "external"

  // Acknowledgement tracking
  acknowledgedAt  DateTime?
  acknowledgedVia String?   @db.VarChar(50)  // "click", "signature", "external"

  // Reminder tracking
  remindersSent   Int       @default(0)
  lastReminderAt  DateTime?

  // Relations
  policy          Policy    @relation(fields: [policyId], references: [id])
  user            User      @relation(fields: [userId], references: [id])

  @@unique([policyId, userId])
  @@index([policyId])
  @@index([userId])
}
```

### 5.2 Distribution Workflow

```
┌─────────────────────────────────────────────────────────────┐
│                    POLICY APPROVED                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              SELECT DISTRIBUTION AUDIENCE                   │
│         All users / Department / Custom selection           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  CREATE DISTRIBUTION RECORDS                │
│              One per user in target audience                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    SEND NOTIFICATIONS                       │
│            Email with link to acknowledge                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  TRACK ACKNOWLEDGEMENTS                     │
│           User clicks link → marks acknowledged             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    GENERATE EVIDENCE                        │
│     "Policy X acknowledged by 95% of staff (47/50)"         │
└─────────────────────────────────────────────────────────────┘
```

### 5.3 Acknowledgement Evidence

```typescript
// Auto-generated when acknowledgement threshold met
{
  title: "Information Security Policy Acknowledgement",
  description: "Staff acknowledgement status for Information Security Policy v2.1",
  type: "acknowledgement",
  source: "lightsail-policy",  // Internal, not integration
  isProvisional: false,  // System-generated, not manual
  metadata: {
    policyId: "pol_xxx",
    policyTitle: "Information Security Policy",
    policyVersion: "2.1",
    distributionDate: "2026-01-01",
    targetAudience: 50,
    acknowledged: 47,
    pending: 3,
    acknowledgementRate: 0.94,
    pendingUsers: [
      { name: "John Doe", email: "john@company.com", remindersSent: 2 },
      // ...
    ]
  }
}
```

### 5.4 Review Automation

| Trigger | Action |
|---------|--------|
| `nextReviewAt` is within 14 days | Create review task, notify policy owner |
| `nextReviewAt` passed | Mark policy as "Review Overdue", escalate |
| Policy marked "Review Overdue" for 7+ days | Block from being used as evidence |

### 5.5 Policy-Control Verification

A control requiring "Policy exists and is acknowledged" is verified when:

```typescript
function verifyPolicyControl(control: Control): VerificationResult {
  const linkedPolicies = control.policyLinks.map(l => l.policy);

  for (const policy of linkedPolicies) {
    // Check 1: Policy is approved
    if (policy.status !== 'approved') {
      return { verified: false, reason: 'Policy not approved' };
    }

    // Check 2: Policy is within review period
    if (policy.nextReviewAt && policy.nextReviewAt < new Date()) {
      return { verified: false, reason: 'Policy review overdue' };
    }

    // Check 3: Acknowledgement rate meets threshold
    const ackRate = await getAcknowledgementRate(policy.id);
    if (ackRate < 0.95) {
      return { verified: false, reason: `Acknowledgement rate ${ackRate * 100}% below 95%` };
    }
  }

  return { verified: true };
}
```

### 5.5 Deliverables Checklist

- [ ] Migration: Create PolicyDistribution table
- [ ] Policy distribution workflow (select audience, create records)
- [ ] Email notification for policy distribution
- [ ] Acknowledgement link/page
- [ ] Reminder system for unacknowledged policies
- [ ] Acknowledgement evidence generation
- [ ] Review task auto-creation
- [ ] Review overdue handling
- [ ] Policy-control verification integration
- [ ] API: Distribute policy endpoint
- [ ] API: Acknowledge policy endpoint
- [ ] API: Get distribution status endpoint
- [ ] UI: Distribution wizard
- [ ] UI: Acknowledgement status view
- [ ] UI: Policy review dashboard

---

## Phase 6: Advanced Integrations

**Goal:** Expand observation coverage to more security domains.

**Duration:** 4-6 weeks (ongoing)

### 6.1 Cloud Security Posture

| Provider | Priority | Data | Controls |
|----------|----------|------|----------|
| AWS Security Hub | High | Aggregated findings | Multiple |
| AWS GuardDuty | Medium | Threat detections | Threat monitoring |
| GCP Security Command Center | Medium | Findings, vulnerabilities | Multiple |
| Azure Security Center | Medium | Recommendations | Multiple |

### 6.2 Endpoint Security

| Provider | Priority | Data | Controls |
|----------|----------|------|----------|
| Microsoft Defender | High | Endpoint status, threats | Endpoint protection |
| CrowdStrike | Medium | Coverage, detections | Endpoint protection |
| Jamf | Medium | Mac device compliance | Device management |
| Intune | Medium | Device compliance | Device management |

### 6.3 Vulnerability Management

| Provider | Priority | Data | Controls |
|----------|----------|------|----------|
| Snyk | High | Code vulnerabilities | Secure development |
| Dependabot | High | Dependency vulnerabilities | Vulnerability management |
| Qualys | Medium | Infrastructure vulnerabilities | Vulnerability management |

### 6.4 HR/People Systems

| Provider | Priority | Data | Controls |
|----------|----------|------|----------|
| BambooHR | Medium | Employee directory, terminations | Access lifecycle |
| Workday | Medium | Employee directory | Access lifecycle |
| Training LMS | Medium | Training completion | Security awareness |

### 6.5 Deliverables Checklist

For each integration:
- [ ] Provider implementation
- [ ] Evidence generators
- [ ] Control mappings
- [ ] Verification rules
- [ ] UI: Connection wizard
- [ ] UI: Status/logs view
- [ ] Documentation

---

## Phase 7: Continuous Compliance Assessment

**Goal:** Real-time compliance state, not point-in-time snapshots.

**Duration:** 2-3 weeks

### 7.1 Compliance State Machine

```typescript
interface ComplianceState {
  organizationId: string;
  frameworkId: string;

  // Overall state
  state: 'compliant' | 'at_risk' | 'non_compliant';
  stateChangedAt: Date;
  previousState: string | null;

  // Metrics
  coveragePercent: number;
  verifiedPercent: number;

  // Requirement-level detail
  requirements: RequirementState[];

  // Timestamps
  assessedAt: Date;
}

interface RequirementState {
  requirementId: string;
  state: 'met' | 'partially_met' | 'not_met';

  // What's contributing
  linkedControls: {
    controlId: string;
    verificationStatus: string;
    healthScore: number;
  }[];

  // What's missing
  gaps: string[];
}
```

### 7.2 State Transitions

```
┌─────────────┐     Gap introduced     ┌─────────────┐
│  COMPLIANT  │ ─────────────────────► │   AT_RISK   │
│             │                        │             │
│ All reqs    │ ◄───────────────────── │ Minor gaps  │
│ met         │     Gap resolved       │ exist       │
└─────────────┘                        └─────────────┘
                                              │
                                              │ Critical gap
                                              │ or multiple gaps
                                              ▼
                                       ┌─────────────┐
                                       │ NON_        │
                                       │ COMPLIANT   │
                                       │             │
                                       │ Major gaps  │
                                       └─────────────┘
```

### 7.3 Real-Time Assessment Triggers

| Event | Action |
|-------|--------|
| Control verification status changes | Re-assess linked requirements |
| Evidence expires | Re-assess linked controls/requirements |
| Evidence added | Re-assess linked controls/requirements |
| Control linked/unlinked to requirement | Re-assess requirement |

### 7.4 Compliance Drift Alerts

```typescript
interface ComplianceDriftAlert {
  id: string;
  organizationId: string;
  frameworkId: string;

  // What changed
  changeType: 'state_transition' | 'coverage_drop' | 'verification_failure';
  previousValue: string | number;
  currentValue: string | number;

  // Impact
  severity: 'info' | 'warning' | 'critical';
  affectedRequirements: string[];

  // Context
  triggeredBy: string;  // What caused this
  triggeredAt: Date;

  // Resolution
  resolvedAt: Date | null;
  resolvedBy: string | null;
}
```

### 7.5 Deliverables Checklist

- [ ] Compliance state model
- [ ] State calculation logic
- [ ] Real-time assessment triggers
- [ ] Drift detection algorithm
- [ ] Alert generation
- [ ] API: Get compliance state
- [ ] API: Get compliance history
- [ ] API: Get drift alerts
- [ ] UI: Compliance state indicator
- [ ] UI: Drift alerts panel
- [ ] UI: Compliance history timeline
- [ ] Notifications: Email on state transition
- [ ] Notifications: Slack/webhook integration

---

## Phase 8: Executive Reporting & Audit Packages

**Goal:** Generate audit-ready outputs and executive communications automatically.

**Duration:** 2-3 weeks

### 8.1 Executive Risk Report

One-page summary suitable for board presentation:

```
┌─────────────────────────────────────────────────────────────────────┐
│                    EXECUTIVE SECURITY SUMMARY                       │
│                      January 2026 | Acme Corp                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  RISK POSTURE                                                       │
│  ─────────────                                                      │
│  Your organization's security risk score is 34/100 (LOW-MEDIUM).    │
│  This is a 12% improvement from last month.                         │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Risk Trend (6 months)                                        │   │
│  │                                                              │   │
│  │  50 ─┐                                                       │   │
│  │      └──┐                                                    │   │
│  │  40 ────┴───┐                                                │   │
│  │             └──────┐                                         │   │
│  │  30 ───────────────┴─────                                    │   │
│  │     Aug  Sep  Oct  Nov  Dec  Jan                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  TOP RISKS REQUIRING ATTENTION                                      │
│  ─────────────────────────────                                      │
│  1. Data Encryption (HIGH) - 2 S3 buckets lack encryption           │
│  2. Access Reviews (MEDIUM) - Q4 review 15 days overdue             │
│  3. Vulnerability Patching (MEDIUM) - 5 critical CVEs pending       │
│                                                                     │
│  RECOMMENDED ACTIONS                                                │
│  ────────────────────                                               │
│  • Enable encryption on production S3 buckets (reduces risk by 8)   │
│  • Complete Q4 access review (compliance requirement)               │
│  • Prioritize critical vulnerability patching                       │
│                                                                     │
│  COMPLIANCE STATUS                                                  │
│  ─────────────────                                                  │
│  ISO 27001: READY FOR AUDIT (94% verified coverage)                 │
│  SOC 2 Type I: 2 GAPS REMAINING (87% verified coverage)             │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Generated by Lightsail | data as of 2026-01-15 09:00 UTC    │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.2 Audit Evidence Package

Downloadable package for each framework:

```
audit-package-iso27001-2026-01/
├── README.md                    # Package overview
├── summary.pdf                  # Executive summary
├── control-matrix.xlsx          # All controls with status
├── evidence/
│   ├── access-control/
│   │   ├── iam-mfa-status-2026-01-15.json
│   │   ├── user-directory-2026-01-15.json
│   │   └── access-review-q4-2025.pdf
│   ├── logging-monitoring/
│   │   ├── cloudtrail-config-2026-01-15.json
│   │   └── alert-rules-2026-01-15.json
│   └── ...
├── policies/
│   ├── information-security-policy-v2.1.pdf
│   ├── acknowledgement-report.pdf
│   └── ...
├── integration-logs/
│   ├── aws-sync-log-2026-01.json
│   └── ...
└── manifest.json               # Package contents with hashes
```

### 8.3 Scheduled Reports

| Report | Frequency | Recipients | Content |
|--------|-----------|------------|---------|
| Executive Summary | Monthly | Executives, Board | Risk posture, trends, actions |
| Compliance Status | Weekly | Compliance team | Coverage, gaps, tasks |
| Security Health | Daily | Security team | Verification failures, expiring evidence |
| Integration Status | Daily | IT/Security | Sync status, errors |

### 8.4 Auditor Portal (Optional)

Read-only interface for external auditors:

- Scoped access (specific framework, date range)
- Evidence viewing and download
- Control status verification
- No edit capabilities
- Full audit logging of auditor access

### 8.5 Deliverables Checklist

- [ ] Executive report template (PDF/HTML)
- [ ] Executive report generator
- [ ] Audit package structure
- [ ] Audit package generator
- [ ] Evidence export (with verification metadata)
- [ ] Scheduled report jobs
- [ ] Report delivery (email, download)
- [ ] API: Generate executive report
- [ ] API: Generate audit package
- [ ] API: List available reports
- [ ] UI: Report configuration
- [ ] UI: Report history/downloads
- [ ] (Optional) Auditor portal

---

## Success Metrics

How do we know we're succeeding?

### Product Metrics

| Metric | Target | Rationale |
|--------|--------|-----------|
| % of evidence auto-generated | > 70% | Proves automation-first approach |
| % of controls verified by integration | > 60% | Proves observation over attestation |
| Avg time from integration connect to first evidence | < 5 min | Proves value delivery speed |
| User time spent on manual evidence tasks | < 2 hr/week | Proves efficiency gains |

### Business Metrics

| Metric | Target | Rationale |
|--------|--------|-----------|
| Time to audit-ready | < 8 weeks | Competitive with Vanta/Drata |
| Customer security incidents post-adoption | Measurably reduced | Proves security-first approach |
| Customer audit pass rate | > 95% | Table stakes |

### Philosophy Alignment Metrics

| Metric | Target | Rationale |
|--------|--------|-----------|
| Manual upload : Auto-generated evidence ratio | < 1:3 | Evidence as by-product |
| Self-attested : Verified controls ratio | < 1:2 | Observation over attestation |
| Dashboard clicks on Risk vs Compliance sections | Risk > Compliance | Risk-first UX |

---

## Anti-Patterns to Avoid

Throughout all phases, reject these patterns:

| Anti-Pattern | Why It's Wrong | What to Do Instead |
|--------------|----------------|-------------------|
| "Let's add a manual upload for X" | Evidence should be generated | "Can we integrate with the system that has X?" |
| "Users can mark this as done" | Self-attestation without verification | "How do we verify this from telemetry?" |
| "Show compliance percentage" | Misleading if based on self-attestation | "Show verified coverage with transparency" |
| "Add a new entity/table for Y" | CRUD is not progress | "Are existing entities connected to reality?" |
| "The auditor needs to see Z" | Audit-first thinking | "What would make the org more secure?" |
| "Let's copy how Vanta does it" | We're not building a Vanta clone | "How would we do this security-first?" |

---

## Document History

| Date | Version | Changes |
|------|---------|---------|
| Jan 2026 | 1.0 | Initial roadmap based on philosophy evaluation |
| Jan 3, 2026 | 1.1 | Updated checklist items: Phase 0 mostly complete, Phase 1 GitHub integration complete, Phase 2 basic verification complete |

---

## References

- [CLAUDE.md](../CLAUDE.md) - Project philosophy and conventions
- [ARCHITECTURE.md](./ARCHITECTURE.md) - System architecture
- [DATABASE_SCHEMA.md](./DATABASE_SCHEMA.md) - Data models
- [INTEGRATIONS.md](./INTEGRATIONS.md) - Integration patterns
